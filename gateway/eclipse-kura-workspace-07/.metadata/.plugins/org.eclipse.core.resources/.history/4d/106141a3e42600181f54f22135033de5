package org.eclipse.kura.demo.heater;

import java.util.Date;

import org.eclipse.kura.KuraException;
import org.eclipse.kura.cloud.CloudClient;
import org.eclipse.kura.cloud.CloudService;
import org.eclipse.kura.message.KuraPayload;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class ErrorPublisher {
	
	public ErrorPublisher(CloudService cloudService) throws KuraException {
	
		logger.info("creating publisher...");
		cloudClient=cloudService.newCloudClient(appID);
		logger.info("creating publisher...Done");
	
	}	
	
	public String topic="SensorData";
	public int qos=2;// quality of service
	public boolean retain =false;
	public final String appID="ErrorCollector";
	
	private CloudClient cloudClient;
	
    private static final Logger logger = LoggerFactory.getLogger(Heater.class);
	
	public void publishData(AccData data) throws Exception{
		
		logger.info("--------start to publishing AccData...");
		KuraPayload payload=new KuraPayload();
		
		payload.addMetric("SensorID", data.SensorID);
		payload.addMetric("MicroTimeStamp", data.MicroTimeStamp);

		payload.addMetric("AccX", data.AccX);
		payload.addMetric("AccY", data.AccY);
		payload.addMetric("AccZ", data.AccZ);

		logger.info("--------publishing add date metric data...");
		payload.setTimestamp(new Date());

		logger.info("--------publishing data...");
		this.cloudClient.publish(topic,payload, qos, retain);
		logger.info("success!");
		
	}
	
	public void publishData(DHTData data) throws Exception{
		
		logger.info("--------start to publishing AccData...");
		KuraPayload payload=new KuraPayload();
		
		payload.addMetric("SensorID", data.SensorID);
		payload.addMetric("MicroTimeStamp", data.MicroTimeStamp);

		payload.addMetric("Humidity", data.Humidity);
		payload.addMetric("Temperature", data.Temperature);

		logger.info("--------publishing add date metric data...");
		payload.setTimestamp(new Date());

		logger.info("--------publishing data...");
		this.cloudClient.publish(topic,payload, qos, retain);
		logger.info("success!");
		
	}
	
	public void open() throws Exception {
	}
	
	public void close() {
		this.cloudClient.release();
	}

}
